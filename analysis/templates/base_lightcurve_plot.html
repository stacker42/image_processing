{% extends 'base.html' %}

{% block title %}Plot a lightcurve{% endblock %}

{% block content %}

    {% load staticfiles %}

    <div class="modal" tabindex="-1" role="dialog" id="genmodal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <p>Generating Lightcurve...</p>
                </div>
            </div>
        </div>
    </div>

    <h1>Lightcurve Plot - Experimental Feature</h1>

    <div id="plot">{{ plot|safe }}</div>

    <br />

    {% for filter in filters %}
        <input name="offset-{{ filter }}" placeholder="Offset for {{ filter }}">
    {% endfor %}

    <button type="button" id="update" class="btn btn-default">Update offset selection</button> <br /> <br />

    <a href="{% url 'lightcurve_download' %}?ra={{ ra }}&dec={{ dec }}" class="btn btn-default">Download data used to make this lightcurve</a>

    <script type="application/javascript">
        /**
         * Load in our lightcurve based on the form input
         */
        $("#update").click(function () {
            $('#genmodal').modal('show');
            offsets = [];

            $("[name*='offset-']").each(function () {
                if ($(this).val()) {
                    offsets.push({'name': $(this).attr('name'), 'value': $(this).val()});
                }
            });

            var url = "?star=true&ra={{ ra }}&dec={{ dec }}";

            for (var j = 0; j < offsets.length; j++) {
                url = url + "&offset=" + offsets[j]['name'].replace('offset-', '') + ":" + offsets[j]['value'];
            }

            window.location.href = encodeURI('{% url 'lightcurve' %}' + url);
        });

    </script>

{% endblock %}